┌─────────────────────────────────────────────────────────┐
│                    사용자 입력                            │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│              Query Classifier (선택)                    │
│  - 키워드 매칭: "요약", "정리" → summary                    │
│  - 키워드 매칭: "무슨", "유형" → classification             │
│  - 기본값: qa                                            │
└─────────────────────────────────────────────────────────┘
                          ↓
            ┌─────────────┼─────────────┐
            ↓             ↓             ↓
    ┌──────────┐  ┌──────────┐  ┌──────────┐
    │    QA    │  │   요약    │  │   분류    │
    └──────────┘  └──────────┘  └──────────┘
         ↓             ↓             ↓
         │      ┌──────┴──────┐      │
         │      ↓             ↓      │
         │  Vector DB     Vector DB  │
         │  (요약 예시)   (분류 예시)  │
         │      ↓             ↓      │
         │  Few-shot      Few-shot   │
         │  Prompt        Prompt     │
         └──────┼─────────┼──────────┘
                ↓
┌─────────────────────────────────────────────────────────┐
│           파인튜닝된 QA 모델                                │
│           + KV Cache (멀티턴 맥락 유지)                     │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                    최종 답변 생성                          │
└─────────────────────────────────────────────────────────┘


### 1️⃣ QA 질문
```
"카드 분실 시점은?" 
"수수료는 얼마야?"
→ 구체적 정보 묻기
```

### 2️⃣ 요약 질문
```
"지금까지 뭘 얘기했어?"
"전체적으로 정리해줘"
→ 대화 내용 요약
```

### 3️⃣ 분류/유형 질문 (같은 것)
```
"이건 무슨 민원이야?"
"어떤 유형이야?"
"무슨 카테고리야?"
→ 유형/카테고리 분류


┌─────────────────────────────────────────────────────────┐
│ 1. classify_query (쿼리 분류)                            │
├─────────────────────────────────────────────────────────┤
│ Input:                                                  │
│   - user_query: str                                     │
│   - recent_context: List[Message]                       │
│                                                         │
│ Output:                                                 │
│   - query_type: "qa" | "summary" | "classification"     │
│                                                         │
│ Method: OpenAI API 호출 (few-shot)                      │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│ 2. retrieve_examples (Vector DB 검색)                   │
├─────────────────────────────────────────────────────────┤
│ Input:                                                  │
│   - user_query: str                                     │
│   - query_type: str (qa/summary/classification)         │
│                                                         │
│ Output:                                                 │
│   - retrieved_examples: List[Dict]                      │
│     [{"instruction": "...", "input": "...",             │
│       "output": "..."}]                                 │
│                                                         │
│ Method: CSV 데이터를 메모리 검색 (Embedding 유사도)        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│ 3. qa_model (질의응답)                                   │
├─────────────────────────────────────────────────────────┤
│ Input:                                                  │
│   - user_query: str                                     │
│   - recent_context: List[Message]                       │
│   - retrieved_examples: List[Dict]                      │
│                                                         │
│ Output:                                                 │
│   - model_response: str                                 │
│                                                         │
│ Method: OpenAI API (few-shot prompt)                    │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│ 4. summary_model (요약)                                  │
├─────────────────────────────────────────────────────────┤
│ Input:                                                  │
│   - conversation_history: List[Message]                 │
│   - retrieved_examples: List[Dict] (옵션)               │
│                                                         │
│ Output:                                                 │
│   - model_response: str                                 │
│                                                         │
│ Method: OpenAI API (요약 프롬프트)                        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│ 5. classification_model (분류)                           │
├─────────────────────────────────────────────────────────┤
│ Input:                                                  │
│   - user_query: str                                     │
│   - recent_context: List[Message]                       │
│   - retrieved_examples: List[Dict] (옵션)               │
│                                                         │
│ Output:                                                 │
│   - model_response: str                                 │
│                                                         │
│ Method: OpenAI API (분류 프롬프트)                        │
└─────────────────────────────────────────────────────────┘